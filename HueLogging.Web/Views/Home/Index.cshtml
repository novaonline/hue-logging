@{
	ViewData["Title"] = "Home Page";
}

<div class="row">
	<div class="col-md-3">
		<h2>Getting Started</h2>
		<ol>
			@* TODO: https://github.com/novaonline/hue-logging/issues/1 *@
			<li><a href="@Url.Action("Index", "Settings")">Connect to the Phillips Hue Bridge</a></li>
			<li><a href="/start">Start the Logging System</a></li>
			@* TODO: https://github.com/novaonline/hue-logging/issues/2 *@
			<li><a href="/hangfire">Monitor the Logging System</a></li>
			<li><a href="/">Analyze Usage</a></li>
		</ol>
	</div>
	@* TODO: https://github.com/novaonline/hue-logging/issues/3 *@
</div>
<div class="row">
	<div class="col-md-12">
		<canvas id="hueUsageChart"></canvas>
	</div>
</div>
@section Scripts {
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.min.js"></script>
	<script>
		var canvas = document.getElementById('hueUsageChart');
		var myDoughnutChart;
		$(document).ready(function () {

			$.post("@Url.Action("GetSummary")", function (data) {
				for (var i in data.datasets) {
					data.datasets[i].backgroundColor = dynamicColors();
				}
				var ctx = canvas.getContext('2d');
				myDoughnutChart = new Chart(ctx, {
					type: 'doughnut',
					data: data
				});
			});
			canvas.onclick = function (evt) {
				var activePoints = myDoughnutChart.getElementsAtEvent(evt);
				if (activePoints[0]) {
					var chartData = activePoints[0]['_chart'].config.data;
					var idx = activePoints[0]['_index'];

					var label = chartData.labels[idx];
					var value = chartData.datasets[0].data[idx];

					var url = "/focuson?lightName=" + label;
					window.location.href = url;
				}
			};
		});
		var dynamicColors = function () {
			var r = Math.floor(Math.random() * 255);
			var g = Math.floor(Math.random() * 255);
			var b = Math.floor(Math.random() * 255);
			return "rgb(" + r + "," + g + "," + b + ")";
		}

	</script>
}